{% extends "base.html" %}

{% block title %}Instructor Performance | EduHub{% endblock %}

{% block main_class %}container-fluid{% endblock %}

{% block extra_css %}
<style>
    /* ✅ PRIMARY THEME (same as top header) */
    :root{
      --perf-a: var(--accent);
      --perf-b: #4f46e5;
      --perf-soft: rgba(99,102,241,0.12);
      --perf-border: rgba(99,102,241,0.18);
      --perf-shadow: rgba(99,102,241,0.18);
      --perf-text: #1e1b2e;
      --perf-muted: #6b7280;
    }

    .performance-header {
        background: var(--accent);
        color: white;
        padding: 60px 0 40px;
        margin-bottom: 40px;
        border-radius: 0 0 30px 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .performance-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="2" fill="white" opacity="0.1"/></svg>');
        opacity: 0.3;
    }

    .hero-content {
        position: relative;
        z-index: 1;
    }

    .performance-title {
        font-family: 'Playfair Display', serif;
        font-size: 2.8rem;
        font-weight: 900;
        margin-bottom: 12px;
        letter-spacing: -0.02em;
    }

    .performance-subtitle {
        font-size: 1.1rem;
        opacity: 0.95;
        font-weight: 500;
    }

    /* Custom SVG Icons */
    .custom-icon {
        width: 48px;
        height: 48px;
        display: inline-block;
        margin-bottom: 8px;
    }

    .instructor-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        border: 2px solid var(--perf-border);
        box-shadow: 0 4px 20px rgba(15, 23, 42, 0.06);
        margin-bottom: 30px;
    }

    /* ✅ changed to match top theme */
    .instructor-header {
        background: var(--accent);
        padding: 30px;
        color: white;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .instructor-avatar {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 900;
        border: 3px solid rgba(255, 255, 255, 0.3);
        flex-shrink: 0;
    }

    .instructor-info h4 {
        font-size: 1.8rem;
        font-weight: 800;
        margin: 0 0 8px 0;
    }

    .instructor-role {
        font-size: 0.95rem;
        opacity: 0.9;
        font-weight: 500;
    }

    .instructor-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        padding: 30px;
        background: #ffffff;
        border-bottom: 2px solid var(--perf-border);
    }

    .stat-item {
        text-align: center;
        padding: 20px;
        background: white;
        border-radius: 16px;
        border: 2px solid var(--perf-border);
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        margin: 0 auto 12px;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 900;
        color: var(--accent);
        margin-bottom: 6px;
    }

    .stat-label {
        font-size: 0.8rem;
        color: var(--perf-muted);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    .course-breakdown {
        padding: 30px;
    }

    .breakdown-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.3rem;
        font-weight: 900;
        color: var(--perf-text);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .breakdown-icon {
        width: 28px;
        height: 28px;
    }

    .course-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    /* ✅ table head gradient to match top theme */
    .course-table thead th {
        background: var(--accent);
        color: white;
        padding: 16px;
        font-weight: 700;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border: none;
    }

    .course-table thead th:first-child {
        border-radius: 12px 0 0 0;
    }

    .course-table thead th:last-child {
        border-radius: 0 12px 0 0;
    }

    .course-table tbody tr {
    }

    .course-table tbody tr:hover {
        background: rgba(99,102,241,0.06);
    }

    .course-table tbody td {
        padding: 18px 16px;
        border-bottom: 1px solid var(--perf-border);
        font-size: 0.95rem;
    }

    .course-table tbody tr:last-child td {
        border-bottom: none;
    }

    .course-table tbody tr:last-child td:first-child {
        border-radius: 0 0 0 12px;
    }

    .course-table tbody tr:last-child td:last-child {
        border-radius: 0 0 12px 0;
    }

    .course-name {
        font-weight: 700;
        color: var(--perf-text);
    }

    /* ✅ changed purple text to theme */
    .marks-value {
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--perf-b);
    }

    .performance-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.85rem;
        letter-spacing: 0.03em;
    }

    /* ✅ ALL badges now use same top theme */
    .badge-excellent,
    .badge-good,
    .badge-average,
    .badge-attention,
    .badge-not-graded {
        background: var(--accent);
        color: white;
    }

    .badge-icon {
        width: 16px;
        height: 16px;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--perf-muted);
        font-style: italic;
    }

    @media (max-width: 768px) {
        .performance-title {
            font-size: 2.2rem;
        }

        .instructor-header {
            flex-direction: column;
            text-align: center;
        }

        .instructor-stats {
            grid-template-columns: 1fr;
        }

        .course-table {
            font-size: 0.85rem;
        }

        .course-table thead th,
        .course-table tbody td {
            padding: 12px 10px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="performance-header">
    <div class="hero-content container">
        <h1 class="performance-title">
            <svg class="custom-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="24" cy="12" r="8" fill="white"/>
                <path d="M24 24C16 24 10 28 10 34V40H38V34C38 28 32 24 24 24Z" fill="white"/>
                <rect x="34" y="10" width="8" height="2" rx="1" fill="white"/>
                <rect x="34" y="14" width="8" height="2" rx="1" fill="white"/>
                <rect x="34" y="18" width="6" height="2" rx="1" fill="white"/>
            </svg>
            Instructor Performance Analysis
        </h1>
        <p class="performance-subtitle">Comprehensive teaching effectiveness and student outcomes overview</p>
    </div>
</div>

<div class="container">
    {% for i in instructors %}
    <div class="instructor-card">
        <!-- Instructor Header -->
        <div class="instructor-header">
            <div class="instructor-avatar">
                {{ i.first_name[0] }}{{ i.last_name[0] }}
            </div>
            <div class="instructor-info">
                <h4>{{ i.first_name }} {{ i.last_name }}</h4>
                <div class="instructor-role">Senior Instructor</div>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="instructor-stats">
            <div class="stat-item">
                <svg class="stat-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="12" width="24" height="20" rx="2" stroke="var(--perf-b)" stroke-width="2"/>
                    <path d="M12 8h16v4H12z" fill="var(--perf-b)"/>
                    <rect x="14" y="18" width="4" height="8" fill="var(--perf-b)"/>
                    <rect x="22" y="16" width="4" height="10" fill="var(--perf-a)"/>
                </svg>
                <div class="stat-value">{{ i.courses }}</div>
                <div class="stat-label">Courses Taught</div>
            </div>

            <div class="stat-item">
                <svg class="stat-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="14" cy="12" r="5" fill="var(--perf-b)"/>
                    <circle cx="26" cy="12" r="5" fill="var(--perf-a)"/>
                    <circle cx="20" cy="22" r="5" fill="var(--perf-b)"/>
                    <path d="M14 20c-4 0-7 2-7 5v3h14v-3c0-3-3-5-7-5z" fill="var(--perf-b)" opacity="0.5"/>
                    <path d="M26 20c-4 0-7 2-7 5v3h14v-3c0-3-3-5-7-5z" fill="var(--perf-a)" opacity="0.5"/>
                    <path d="M20 30c-4 0-7 2-7 5v3h14v-3c0-3-3-5-7-5z" fill="var(--perf-b)" opacity="0.5"/>
                </svg>
                <div class="stat-value">{{ i.students }}</div>
                <div class="stat-label">Total Students</div>
            </div>

            <div class="stat-item">
                <svg class="stat-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 8l3 9h9l-7 6 3 9-8-6-8 6 3-9-7-6h9z" fill="var(--perf-b)"/>
                </svg>
                <div class="stat-value">
                    {{ "%.1f"|format(i.avg_marks) if i.avg_marks is not none else "—" }}
                </div>
                <div class="stat-label">Overall Avg Marks</div>
            </div>
        </div>

        <!-- Course Breakdown -->
        <div class="course-breakdown">
            <h5 class="breakdown-title">
                <svg class="breakdown-icon" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="4" y="6" width="20" height="16" rx="2" stroke="var(--perf-b)" stroke-width="2"/>
                    <path d="M8 4h12v2H8z" fill="var(--perf-b)"/>
                    <line x1="4" y1="11" x2="24" y2="11" stroke="var(--perf-b)" stroke-width="1.5"/>
                    <line x1="4" y1="16" x2="24" y2="16" stroke="var(--perf-b)" stroke-width="1.5"/>
                </svg>
                Course-wise Performance
            </h5>

            <table class="course-table">
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Average Marks</th>
                        <th>Performance Rating</th>
                    </tr>
                </thead>
                <tbody>
                    {% set has_courses = false %}
                    {% for c in instructor_courses %}
                        {% if c.user_id == i.user_id %}
                            {% set has_courses = true %}
                            <tr>
                                <td class="course-name">{{ c.course_name }}</td>
                                <td class="marks-value">
                                    {{ "%.1f"|format(c.avg_marks) if c.avg_marks is not none else "—" }}
                                </td>
                                <td>
                                    {% if c.avg_marks is none %}
                                        <span class="performance-badge badge-not-graded">
                                            <svg class="badge-icon" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="8" cy="8" r="6" stroke="white" stroke-width="1.5" fill="none"/>
                                                <path d="M8 5v4M8 11h.01" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                            </svg>
                                            Not Graded
                                        </span>
                                    {% elif c.avg_marks >= 75 %}
                                        <span class="performance-badge badge-excellent">
                                            <svg class="badge-icon" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M8 2l1.5 4.5h4.5l-3.5 3 1.5 4.5L8 11l-4 3 1.5-4.5-3.5-3h4.5z"/>
                                            </svg>
                                            Excellent
                                        </span>
                                    {% elif c.avg_marks >= 60 %}
                                        <span class="performance-badge badge-good">
                                            <svg class="badge-icon" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M3 8l3 3 7-7" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/>
                                            </svg>
                                            Good
                                        </span>
                                    {% elif c.avg_marks >= 40 %}
                                        <span class="performance-badge badge-average">
                                            <svg class="badge-icon" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="8" cy="8" r="6" stroke="white" stroke-width="1.5" fill="none"/>
                                                <line x1="5" y1="8" x2="11" y2="8" stroke="white" stroke-width="1.5"/>
                                            </svg>
                                            Average
                                        </span>
                                    {% else %}
                                        <span class="performance-badge badge-attention">
                                            <svg class="badge-icon" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M8 2L2 14h12L8 2z" fill="white"/>
                                                <path d="M8 6v4M8 11h.01" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                            </svg>
                                            Needs Attention
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}

                    {% if not has_courses %}
                        <tr>
                            <td colspan="3" class="empty-state">
                                No courses currently assigned to this instructor
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
