{% extends "base.html" %}

{% block title %}Courses | Admin | EduHub{% endblock %}

{% block main_class %}container{% endblock %}

{% block extra_css %}
<style>
.admin-page-header { padding: 30px 0 20px; }
.admin-page-header h1 { font-family: 'Playfair Display', serif; font-size: 1.75rem; font-weight: 800; color: var(--primary); }
.admin-section { background: white; border-radius: 24px; padding: 32px; border: 2px solid var(--border-subtle); margin-bottom: 24px; }
.admin-section h3 { font-size: 1.15rem; font-weight: 700; color: var(--primary); margin-bottom: 20px; }
.admin-table { width: 100%; border-collapse: collapse; }
.admin-table th { text-align: left; padding: 12px 16px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); border-bottom: 2px solid var(--border-subtle); }
.admin-table td { padding: 14px 16px; border-bottom: 1px solid var(--border-subtle); }
.admin-table tr:hover td { background: var(--accent-soft); }
.admin-table .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
.admin-table .instructor-list { margin-bottom: 8px; }
.admin-table .instructor-list form { display: inline; margin-right: 6px; }
.add-prompt { margin-bottom: 16px; }
.add-form { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-subtle); }
.add-form.show { display: block; }
</style>
{% endblock %}

{% block content %}
<div class="admin-page-header">
    <a href="{{ url_for('admin.dashboard') }}" class="text-eduhub text-decoration-none mb-2 d-inline-block"><i class="fas fa-arrow-left me-2"></i>Back to Dashboard</a>
    <h1><i class="fas fa-book-open me-2"></i>Courses</h1>
</div>

<div class="admin-section">
    <h3>All Courses</h3>
    <p class="text-muted small mb-3">Add or remove teachers (instructors) for each course. You can also remove a course entirely.</p>
    {% if items %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr><th>Course Name</th><th>University</th><th>Duration</th><th>Type</th><th>Instructors</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for c in items %}
                <tr>
                    <td><strong>{{ c.course_name }}</strong></td>
                    <td>{{ c.university.uni_name if c.university else '—' }}</td>
                    <td>{{ c.duration_weeks or '—' }} wk</td>
                    <td>{{ (c.c_type.value if hasattr(c.c_type, 'value') else c.c_type) or '—' }}</td>
                    <td>
                        <div class="instructor-list">
                            {% for inst in c.instructors %}
                            <span class="d-inline-block mb-1">
                                {{ inst.first_name }} {{ inst.last_name or '' }}
                                <form method="POST" class="d-inline" onsubmit="return confirm('Remove this instructor from the course?');">
                                    <input type="hidden" name="action" value="remove_instructor">
                                    <input type="hidden" name="course_id" value="{{ c.course_id }}">
                                    <input type="hidden" name="instructor_id" value="{{ inst.id }}">
                                    <button type="submit" class="btn btn-link btn-sm text-danger p-0 ms-1" title="Remove from course"><i class="fas fa-times"></i></button>
                                </form>
                            </span>
                            {% else %}
                            <span class="text-muted">None assigned</span>
                            {% endfor %}
                        </div>
                        <form method="POST" class="d-flex gap-1 flex-wrap align-items-center">
                            <input type="hidden" name="action" value="add_instructor">
                            <input type="hidden" name="course_id" value="{{ c.course_id }}">
                            <select name="instructor_id" class="form-select form-select-sm" style="max-width: 180px;">
                                <option value="">Add instructor…</option>
                                {% for i in instructors_list %}
                                {% if i not in c.instructors %}
                                <option value="{{ i.id }}">{{ i.first_name }} {{ i.last_name or '' }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-eduhub-primary btn-sm"><i class="fas fa-plus me-1"></i>Add</button>
                        </form>
                    </td>
                    <td>
                        <form method="POST" class="d-inline" onsubmit="return confirm('Delete this course? All enrollments will be removed.');">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="course_id" value="{{ c.course_id }}">
                            <button type="submit" class="btn btn-outline-danger btn-sm"><i class="fas fa-trash-alt me-1"></i>Remove course</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted mb-0">No courses in the database yet.</p>
    {% endif %}
</div>

<div class="admin-section">
    <h3>Add New Course</h3>
    <p class="text-muted mb-3">Do you want to add a new course to the database?</p>
    <div class="add-prompt">
        <button type="button" class="btn btn-eduhub-primary" onclick="document.getElementById('add-form').classList.add('show')">
            <i class="fas fa-plus me-2"></i>Yes, Add Course
        </button>
    </div>
    <div id="add-form" class="add-form">
        <form method="POST">
            <input type="hidden" name="action" value="add">
            <div class="row g-3">
                <div class="col-md-8"><label class="form-label">Course Name *</label><input type="text" name="course_name" class="form-control" required></div>
                <div class="col-md-4"><label class="form-label">University *</label><select name="uni_id" class="form-select" required>
                    <option value="">-- Select University --</option>
                    {% for u in universities %}<option value="{{ u.uni_id }}">{{ u.uni_name }}</option>{% endfor %}
                </select>{% if not universities %}<p class="text-muted small mt-1">Add universities first from the Universities page.</p>{% endif %}</div>
                <div class="col-md-4"><label class="form-label">Duration (weeks)</label><input type="number" name="duration_weeks" class="form-control" min="1"></div>
                <div class="col-md-4"><label class="form-label">Type</label><select name="c_type" class="form-select">
                    <option value="">-- Select --</option>
                    <option value="degree">Degree</option>
                    <option value="diploma">Diploma</option>
                    <option value="certificate">Certificate</option>
                </select></div>
            </div>
            <button type="submit" class="btn btn-eduhub-primary mt-3"><i class="fas fa-save me-2"></i>Add Course</button>
        </form>
    </div>
</div>
{% endblock %}
