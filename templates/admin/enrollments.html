{% extends "base.html" %}

{% block title %}Enrollments | Admin | EduHub{% endblock %}

{% block main_class %}container{% endblock %}

{% block extra_css %}
<style>
.admin-page-header { padding: 30px 0 20px; }
.admin-page-header h1 { font-family: 'Playfair Display', serif; font-size: 1.75rem; font-weight: 800; color: var(--primary); }
.admin-section { background: white; border-radius: 24px; padding: 32px; border: 2px solid var(--border-subtle); margin-bottom: 24px; }
.admin-section h3 { font-size: 1.15rem; font-weight: 700; color: var(--primary); margin-bottom: 20px; }
.admin-table { width: 100%; border-collapse: collapse; }
.admin-table th { text-align: left; padding: 12px 16px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); border-bottom: 2px solid var(--border-subtle); }
.admin-table td { padding: 14px 16px; border-bottom: 1px solid var(--border-subtle); }
.admin-table tr:hover td { background: var(--accent-soft); }
.admin-table .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
.add-prompt { margin-bottom: 16px; }
.add-form { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-subtle); }
.add-form.show { display: block; }
</style>
{% endblock %}

{% block content %}
<div class="admin-page-header">
    <a href="{{ url_for('admin.dashboard') }}" class="text-eduhub text-decoration-none mb-2 d-inline-block"><i class="fas fa-arrow-left me-2"></i>Back to Dashboard</a>
    <h1><i class="fas fa-clipboard-list me-2"></i>Enrollments</h1>
</div>

<div class="admin-section">
    <h3>All Enrollments</h3>
    {% if items %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr><th>Student</th><th>Course</th><th>Date</th><th>Grade</th><th>Due By</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for enr, course, student in items %}
                <tr>
                    <td><strong>{{ student.first_name }} {{ student.last_name or '' }}</strong></td>
                    <td>{{ course.course_name }}</td>
                    <td>{{ enr.enrollment_date.strftime('%b %d, %Y') if enr.enrollment_date else '—' }}</td>
                    <td>{{ enr.grade or '—' }}</td>
                    <td>{{ enr.due_by.strftime('%b %d, %Y') if enr.due_by else '—' }}</td>
                    <td>
                        <form method="POST" class="d-inline" onsubmit="return confirm('Remove this student from the course?');">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="student_id" value="{{ student.user_id }}">
                            <input type="hidden" name="course_id" value="{{ course.course_id }}">
                            <button type="submit" class="btn btn-outline-danger btn-sm"><i class="fas fa-user-minus me-1"></i>Remove</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted mb-0">No enrollments in the database yet.</p>
    {% endif %}
</div>

<div class="admin-section">
    <h3>Add New Enrollment</h3>
    <p class="text-muted mb-3">Do you want to add a new enrollment (assign a student to a course)?</p>
    <div class="add-prompt">
        <button type="button" class="btn btn-eduhub-primary" onclick="document.getElementById('add-form').classList.add('show')">
            <i class="fas fa-plus me-2"></i>Yes, Add Enrollment
        </button>
    </div>
    <div id="add-form" class="add-form">
        <form method="POST">
            <input type="hidden" name="action" value="add">
            <div class="row g-3">
                <div class="col-md-6"><label class="form-label">Student *</label><select name="student_id" class="form-select" required>
                    <option value="">-- Select Student --</option>
                    {% for s in students %}<option value="{{ s.user_id }}">{{ s.first_name }} {{ s.last_name or '' }} ({{ s.email }})</option>{% endfor %}
                </select></div>
                <div class="col-md-6"><label class="form-label">Course *</label><select name="course_id" class="form-select" required>
                    <option value="">-- Select Course --</option>
                    {% for c in courses %}<option value="{{ c.course_id }}">{{ c.course_name }}</option>{% endfor %}
                </select></div>
                <div class="col-md-4"><label class="form-label">Grade (0-100)</label><input type="number" name="grade" class="form-control" min="0" max="100" step="0.01"></div>
                <div class="col-md-4"><label class="form-label">Due By</label><input type="date" name="due_by" class="form-control"></div>
            </div>
            <button type="submit" class="btn btn-eduhub-primary mt-3"><i class="fas fa-save me-2"></i>Add Enrollment</button>
        </form>
    </div>
</div>
{% endblock %}
